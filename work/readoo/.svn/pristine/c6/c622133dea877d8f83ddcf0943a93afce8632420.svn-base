<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>readoo后台管理</title>

    <script src="__ECHARTS__/echarts.js" type="text/javascript"></script>

    <!-- Bootstrap Core CSS -->
    <link href="__PUBLIC__/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="__PUBLIC__/css/plugins/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- Timeline CSS -->
    <link href="__PUBLIC__/css/plugins/timeline.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="__PUBLIC__/css/sb-admin-2.css" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="__PUBLIC__/css/plugins/morris.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="__PUBLIC__/font-awesome-4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="__PUBLIC__/js/html5shiv.js"></script>
    <script src="__PUBLIC__/js/respond.min.js"></script>
    <script src="__ECHARTS__/build/dist/echarts.js" type="text/javascript"></script>
    <![endif]-->
</head>
<body>
<include file='Public:header'/>
<include file='Public:sidebar'/>
    <div id="wrapper">
        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">后台数据</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-comments fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div class="huge">{$num_new_day_user}/{$num_active_day_user}</div>
                                    <div>新增用户数/活跃用户数</div>
                                </div>
                            </div>
                        </div>
                        <a href="/Admin/AddActiveUserTable/index.html">
                            <div class="panel-footer">
                                <span class="pull-left">查看详情</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-green">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-tasks fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div class="huge">{$num_new_day_task}</div>
                                    <div>新增任务数</div>
                                </div>
                            </div>
                        </div>
                        <a href="/Admin/AddTaskTable/index.html">
                            <div class="panel-footer">
                                <span class="pull-left">查看详情</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-yellow">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-shopping-cart fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div class="huge">{$num_releasenote}</div>
                                    <div>笔记发布数</div>
                                </div>
                            </div>
                        </div>
                        <a href="/Admin/ReleaseNoteTable/index.html">
                            <div class="panel-footer">
                                <span class="pull-left">查看详情</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-red">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-support fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div class="huge">{$num_feedback}</div>
                                    <div>用户反馈吐槽数</div>
                                </div>
                            </div>
                        </div>
                        <a href="/Admin/DataChart/feedback_chart.html">
                            <div class="panel-footer">
                                <span class="pull-left">查看详情</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            <div id="page-user" style="height: 1500px">
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-bar-chart-o fa-fw"></i> 新增用户数/活跃用户数
                        </div>
                        <div class="panel-body">
                            <div id="new_active_user" style="height:400px;width:100%;"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-bar-chart-o fa-fw"></i> 分享用户数/完成用户数
                        </div>
                        <div class="panel-body">
                            <div id="share_complete_user" style="height:400px;width:100%;"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-bar-chart-o fa-fw"></i> 新增任务数/笔记发布数
                        </div>
                        <div class="panel-body">
                            <div id="new_task" style="height:400px;width:100%;"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-bar-chart-o fa-fw"></i> 用户反馈吐槽数
                        </div>
                        <div class="panel-body">
                            <div id="feedback_bar" style="height:400px;width:100%;"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-bar-chart-o fa-fw"></i> 新增任务天数分布
                        </div>
                        <div class="panel-body">
                            <div id="new_task_day_detail_pie" style="height:400px;width:100%;"></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <i class="fa fa-bar-chart-o fa-fw"></i> 书籍完成数天数分布
                        </div>
                        <div class="panel-body">
                            <div id="new_book_day_detail_pie" style="height:400px;width:100%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /#page-wrapper -->
    </div>
    <!-- /#wrapper -->

    <!-- jQuery Version 1.11.0 -->
    <script src="__PUBLIC__/js/jquery-1.11.0.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="__PUBLIC__/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="__PUBLIC__/js/plugins/metisMenu/metisMenu.min.js"></script>

    <!-- Morris Charts JavaScript -->
    <script src="__PUBLIC__/js/plugins/morris/raphael.min.js"></script>
    <!-- Custom Theme JavaScript -->
    <script src="__PUBLIC__/js/sb-admin-2.js"></script>

</body>
<script type="text/javascript">
    var dashboard = document.getElementById('dashboard');
    dashboard.setAttribute("class", "active");
</script>
<script type="text/javascript">
    // Step:3 conifg ECharts's path, link to echarts.js from current page.
    // Step:3 为模块加载器配置echarts的路径，从当前页面链接到echarts.js，定义所需图表路径
    require.config({
        paths: {
            echarts: '/public/Admin/echarts'
        }
    });

    // Step:4 require echarts and use it in the callback.
    // Step:4 动态加载echarts然后在回调函数中开始使用，注意保持按需加载结构定义图表路径
    require(
            [
                'echarts',
                'echarts/chart/bar',
                'echarts/chart/map',
                'echarts/chart/pie',
                'echarts/chart/line',
            ],
            function (ec) {
                //--- 折柱 ---
                var chart_data='';
                var chart_xaxis='';
                var chart_datas='';
                var chart_end_data='';
                var chart_share_data = '';
                var chart_new_task = '';
                var chart_feedback_bar='';
                var chart_new_task_pie_value = '';
                var chart_book_finish_pie_value = '';
                var chart_release_note='';

                //统计新增用户量
                $.ajax({
                    url: '/Admin/Backend/statNewUser',
                    type: 'post',
                    async: false,
                    data: {},
                    dataType: 'json',
                    success: function(msg){
                        if(msg.code == '1'){

                            chart_data = msg.data;
                            chart_xaxis = msg.xaxis;
                        }else{
                            alert("error");
                        }
                    }
                });
                //统计活跃用户量
                $.ajax({
                    url: '/Admin/Backend/statActiveUser',
                    type: 'post',
                    async: false,
                    data: {},
                    dataType: 'json',
                    success: function(msg){
                        if(msg.code == '1'){

                            chart_datas = msg.data;
                        }else{
                            alert("error");
                        }
                    }
                });

                var myUser = ec.init(document.getElementById('new_active_user'));
                myUser.setOption({
                    tooltip : {
                        trigger: 'axis'
                    },
                    legend: {
                        data:['新增用户量','活跃用户量']
                    },
                    toolbox: {
                        show : false,
                        feature : {
                            mark : {show: false},
                            dataView : {show: false, readOnly: false},
                            magicType : {show: false, type: ['line', 'bar', 'stack', 'tiled']},
                            restore : {show: true},
                            saveAsImage : {show: true}
                        }
                    },
                    calculable : true,
                    grid:{
                        x:30,
                        x2:10
                    },
                    xAxis : [
                        {
                            type : 'category',
                            boundaryGap : false,
                            data : chart_xaxis
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value'
                        }
                    ],
                    series : [
                        {
                            name:'新增用户量',
                            type:'line',
                            stack: '总量',
                            data:chart_data
                        },
                        {
                            name:'活跃用户量',
                            type:'line',
                            stack: '总量',
                            data:chart_datas
                        },
                    ]

                });

                //统计分享量
                $.ajax({
                    url: '/Admin/Backend/statSharetask',
                    type: 'post',
                    async: false,
                    data: {},
                    dataType: 'json',
                    success: function(msg){
                        if(msg.code == '1'){
                            chart_share_data = msg.data;
                        }else{
                            alert("error");
                        }
                    }
                });
                //统计完成量
                $.ajax({
                    url: '/Admin/Backend/statEndtask',
                    type: 'post',
                    async: false,
                    data: {},
                    dataType: 'json',
                    success: function(msg){
                        if(msg.code == '1'){

                            chart_end_data = msg.data;
                        }else{
                            alert("error");
                        }
                    }
                });
                var myShareComplete = ec.init(document.getElementById('share_complete_user'));
                myShareComplete.setOption({
                    tooltip : {
                        trigger: 'axis'
                    },
                    legend: {
                        data:['分享数','完成数']
                    },
                    toolbox: {
                        show : false,
                        feature : {
                            mark : {show: false},
                            dataView : {show: false, readOnly: false},
                            magicType : {show: false, type: ['line', 'bar']},
                            restore : {show: true},
                            saveAsImage : {show: true}
                        }
                    },
                    calculable : true,
                    grid:{
                        x:30,
                        x2:10
                    },
                    xAxis : [
                        {
                            type : 'category',
                            data : chart_xaxis
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value',
                            splitArea : {show : true}
                        }
                    ],
                    series : [
                        {
                            name:'分享数',
                            type:'bar',
                            data:chart_share_data
                            //data:[{'name':'0','value':'12'},{'name':'2','value':'38'}]
                        },
                        {
                            name:'完成数',
                            type:'bar',
                            data:chart_end_data
                            //data:[{'name':'0','value':'12'},{'name':'2','value':'38'}]
                        }
                    ]
                });

                //统计7天新增任务数
                $.ajax({
                    url: '/Admin/Backend/statNewtask',
                    type: 'post',
                    async: false,
                    data: {},
                    dataType: 'json',
                    success: function(msg){
                        if(msg.code == '1'){
                            chart_new_task = msg.data;
                        }else{
                            alert("error");
                        }
                    }
                });

                //统计7天笔记发布数
                $.ajax({
                    url: '/Admin/Backend/statReleaseNote',
                    type: 'post',
                    async: false,
                    data: {},
                    dataType: 'json',
                    success: function(msg){
                        if(msg.code == '1'){
                            chart_release_note = msg.data;
                        }else{
                            alert("error");
                        }
                    }
                });

                var myNewTask = ec.init(document.getElementById('new_task'));
                myNewTask.setOption({
                    tooltip : {
                        trigger: 'axis'
                    },
                    legend: {
                        data:['新增任务数','笔记发布数']
                    },
                    toolbox: {
                        show : false,
                        feature : {
                            mark : {show: false},
                            dataView : {show: false, readOnly: false},
                            magicType : {show: false, type: ['line', 'bar', 'stack', 'tiled']},
                            restore : {show: true},
                            saveAsImage : {show: true}
                        }
                    },
                    calculable : true,
                    grid:{
                        x:30,
                        x2:10
                    },
                    xAxis : [
                        {
                            type : 'category',
                            boundaryGap : false,
                            data : chart_xaxis
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value'
                        }
                    ],
                    series : [
                        {
                            name:'新增任务数',
                            type:'line',
                            smooth:true,
                            itemStyle: {normal: {areaStyle: {type: 'default'}}},
                            data:chart_new_task
                        },
                        {
                            name:'发布笔记数',
                            type:'line',
                            smooth:true,
                            itemStyle: {normal: {areaStyle: {type: 'default'}}},
                            data:chart_release_note
                        },
                    ]

                });

                //统计7天用户反馈数
                $.ajax({
                    url: '/Admin/Backend/statFeedbackTask',
                    type: 'post',
                    async: false,
                    data: {},
                    dataType: 'json',
                    success: function(msg){
                        if(msg.code == '1'){
                            chart_feedback_bar = msg.data;
                        }else{
                            alert("error");
                        }
                    }
                });
                var myFeedback = ec.init(document.getElementById('feedback_bar'));
                myFeedback.setOption({
                    tooltip : {
                        trigger: 'axis'
                    },
                    legend: {
                        data:['用户反馈吐槽数']
                    },
                    toolbox: {
                        show : false,
                        feature : {
                            mark : {show: false},
                            dataView : {show: false, readOnly: false},
                            magicType : {show: false, type: ['line', 'bar']},
                            restore : {show: true},
                            saveAsImage : {show: true}
                        }
                    },
                    grid:{
                        x:30,
                        x2:10
                    },
                    calculable : true,
                    xAxis : [
                        {
                            type : 'category',
                            data : chart_xaxis
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value',
                            splitArea : {show : true}
                        }
                    ],
                    series : [
                        {
                            name:'用户反馈吐槽数',
                            type:'bar',
                            data:chart_feedback_bar
                        }
                    ]
                });

                //每周新增任务天数
                $.ajax({
                    url: '/Admin/Backend/statNewTaskDays',
                    type: 'post',
                    async: false,
                    data: {},
                    dataType: 'json',
                    success: function(msg){
                        if(msg.code == '1'){
                            chart_new_task_pie_value = msg.data;
                        }else{
                            alert("error");
                        }
                    }
                });
                var myNewTaskPie = ec.init(document.getElementById('new_task_day_detail_pie'));
                myNewTaskPie.setOption({
                    tooltip : {
                        trigger: 'item',
                    },
                    legend: {
                        orient : 'vertical',
                        x : 'left',
                        data:chart_new_task_pie_value
                    },
                    toolbox: {
                        show : false,
                        feature : {
                            mark : {show: false},
                            dataView : {show: false, readOnly: false},
                            magicType : {
                                show: true,
                                type: ['pie', 'funnel'],
                                option: {
                                    funnel: {
                                        x: '25%',
                                        width: '50%',
                                        funnelAlign: 'left',
                                        max: 1548
                                    }
                                }
                            },
                            restore : {show: true},
                            saveAsImage : {show: true}
                        }
                    },
                    calculable : true,
                    series : [
                        {
                            name:'新增任务天数分布',
                            type:'pie',
                            radius : ['50%', '70%'],
                            itemStyle : {
                                normal : {
                                    label : {
                                        show : false
                                    },
                                    labelLine : {
                                        show : false
                                    }
                                },
                                emphasis : {
                                    label : {
                                        show : true,
                                        position : 'center',
                                        textStyle : {
                                            fontSize : '30',
                                            fontWeight : 'bold'
                                        }
                                    }
                                }
                            },
                            data:chart_new_task_pie_value
                        }
                    ]
                });

                //每周书籍完成天数
                $.ajax({
                    url: '/Admin/Backend/statBookFinishDays',
                    type: 'post',
                    async: false,
                    data: {},
                    dataType: 'json',
                    success: function(msg){
                        if(msg.code == '1'){
                            chart_book_finish_pie_value = msg.data;
                        }else{
                            alert("error");
                        }
                    }
                });
                var myNewBookPie = ec.init(document.getElementById('new_book_day_detail_pie'));
                myNewBookPie.setOption({
                    tooltip : {
                        trigger: 'item',
                    },
                    legend: {
                        orient : 'vertical',
                        x : 'left',
                        data:chart_book_finish_pie_value
                    },
                    toolbox: {
                        show : false,
                        feature : {
                            mark : {show: false},
                            dataView : {show: false, readOnly: false},
                            magicType : {
                                show: true,
                                type: ['pie', 'funnel'],
                                option: {
                                    funnel: {
                                        x: '25%',
                                        width: '50%',
                                        funnelAlign: 'left',
                                        max: 1548
                                    }
                                }
                            },
                            restore : {show: true},
                            saveAsImage : {show: true}
                        }
                    },
                    calculable : true,
                    series : [
                        {
                            name:'书籍完成天数分布',
                            type:'pie',
                            radius : ['50%', '70%'],
                            itemStyle : {
                                normal : {
                                    label : {
                                        show : false
                                    },
                                    labelLine : {
                                        show : false
                                    }
                                },
                                emphasis : {
                                    label : {
                                        show : true,
                                        position : 'center',
                                        textStyle : {
                                            fontSize : '30',
                                            fontWeight : 'bold'
                                        }
                                    }
                                }
                            },
                            data:chart_book_finish_pie_value
                        }
                    ]
                });
            }
    );
</script>
</html>
